---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(rjson)
library(dplyr)
library(tokenizers)
library(stopwords)
library(stringr)

jobs_2020 = fromJSON(file = "indeed_job_descs_2020_09_20.json")
jobs_2021 = fromJSON(file = "indeed_job_descs_2021_01_25.json")
```


Getting the data into a workable DF
```{r}
jobs_df = data.frame("Job", "State", "Employment", 
                     "description", 2020)

names(jobs_df) = c("Job","State","Employment", "Description", "Year")

for(i in 1:length(jobs_2020)) {
  job = jobs_2020[[i]]$request_params[1]
  state = jobs_2020[[i]]$request_params[2]
  employment = jobs_2020[[i]]$request_params[3]
  year = 2020
  
  #print(i)
  
  for(j in 1:length(jobs_2020[[i]]$job_descriptions)) {
    descript = jobs_2020[[i]]$job_descriptions[j]
    temp_df = as.data.frame(c(job,state,employment, descript, year))
    names(temp_df) = c("Job","State","Employment", "Description", "Year")
    jobs_df = rbind(jobs_df, temp_df)
    #print(j)
  }
}


head(jobs_df)
dim(jobs_df)
```
There is no data for anything past the 4th description
```{r}
#1:4 because every job after the 4th one has no description
for(i in 1:4) {
  job = jobs_2021[[i]]$request_params[1]
  state = jobs_2021[[i]]$request_params[2]
  employment = jobs_2021[[i]]$request_params[3]
  year = 2021
  
  print(i)
  
  for(j in 1:length(jobs_2021[[i]]$job_descriptions)) {
    descript = jobs_2021[[i]]$job_descriptions[j]
    temp_df = as.data.frame(c(job,state,employment, descript, year))
    names(temp_df) = c("Job","State","Employment", "Description", "Year")
    jobs_df = rbind(jobs_df, temp_df)
    print(j)
  }
}

#jobs_2021
head(jobs_df)
dim(jobs_df)

#remove the first row because it is useless
jobs_df <- jobs_df[-1,]

#make the names easier for when we split
jobs_df$Job = str_replace_all(jobs_df$Job, "\\+", "_")

#remove potential sources of weird string behavior
#in a couple of samples it was relatively common to see "a.T" as in the end of one sentance into the next
jobs_df$Description = str_replace_all(jobs_df$Description, "\\.", " ")
```


```{r}
#just some visualization of the data 
par(mar=c(11,4,4,4))
barplot(height = table(jobs_df$Job), las = 2, cex.names = .75)

table(jobs_df$Job)
```

You will need to download tokenizers and stopwords
```{r}
#splitting the DF
split_df = split(jobs_df, jobs_df$Job)

#tokenize function that takes job descriptions and tokenizes them in a new DF
#That DF gets merged back with the old one 
tokenize.df = function(df) {
  
  temp = data.frame()
  for (i in 1:length(df$Description)) {
    tokens = table(tokenize_words(df$Description[i], 
                                  stopwords = stopwords::stopwords("en")))
    #temp DF to merge later 
    temp = bind_rows(temp, tokens)
    
  }
  #setting NA to 0 because it is easier to use in this case
  temp[is.na(temp)] = 0
  df = bind_cols(df,temp)
  return(df)
}
```

This part takes some time
```{r}
#for loop to go through each job type and tokenize the description
for (i in 1:length(split_df)) {
  temp = split_df[i]
  split_df[[i]] = tokenize.df(temp[[1]])
  print(i)
}
```
This part is grabbing the totals of each column 
```{r}
master_li = list()
for (i in 1:length(split_df)) {
  
  #getting a temp holder
  temp = apply(split_df[[i]][,6:length(split_df[[i]])], 2, sum)
  #getting a normalization factor 
  factor =mean(apply(split_df[[i]][,6:length(split_df[[i]])], 1, sum))
  #getting some sort of normalized data for the master list
  master_li[[names(split_df)[i]]] = temp / factor
  
}

max(master_li$human_resource_specialist)
```

```{r}
#inputting my resume 
resume = readLines("test.txt", warn = F)
resume = str_c(resume, sep = " ", collapse = " ") 
resume

#tokenizing the resume 
resume_tokens = table(tokenize_words(resume, 
                                  stopwords = stopwords::stopwords("en")))

resume_tokens = as.list(resume_tokens, all.names = F)

resume_tokens = as.data.frame(resume_tokens)
resume_tokens
```

```{r}
#function that multiplys columns in DFs together 
multi = function(df) {
  if (length(df) < 3) {
    return(df[1] * df[2])
  } else {
    times = df[1] * df[2]
    for(i in 3:length(df)) {
      times = df[i] * times  
    }
    return(times)
  }
}

#tester to make sure multi works
#df = data.frame(x1 = c(1,2),
#                x2 = c(1,2))

#apply(df, 2, multi)

tester = bind_rows(master_li[[3]], resume_tokens)
tester[is.na(tester)] = 0

sum(apply(tester, 2, multi), na.rm = T)
```




 
```{r}
#split dataframe into new dataframes based on job description
library(dplyr)
master_df <- jobs_df %>%
  group_by(Job)

group_split(master_df)
group_keys(master_df)


#stopwords::stopwords("en", source = "snowball")
```
